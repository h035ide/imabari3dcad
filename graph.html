<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neo4j Knowledge Graph</title>
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style type="text/css">
        html, body {
            font: 10pt sans;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        #mynetwork {
            width: 100%;
            height: 100%;
            border: 1px solid lightgray;
        }
        #loadingMessage {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            color: #666;
        }
    </style>
</head>
<body>

<div id="mynetwork"></div>
<div id="loadingMessage">Loading graph data...</div>

<script type="text/javascript">
    async function drawGraph() {
        const container = document.getElementById('mynetwork');
        const loadingMessage = document.getElementById('loadingMessage');

        try {
            // Load the graph data from the JSON file
            const response = await fetch('graph_data.json');
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const graphData = await response.json();

            loadingMessage.style.display = 'none';

            // Create a DataSet for nodes and edges
            const nodes = new vis.DataSet(graphData.nodes);
            const edges = new vis.DataSet(graphData.edges);

            const data = {
                nodes: nodes,
                edges: edges,
            };

            const options = {
                nodes: {
                    shape: 'dot',
                    size: 16,
                    font: {
                        size: 14,
                        color: '#333'
                    },
                    borderWidth: 2
                },
                edges: {
                    width: 2,
                    font: {
                        align: 'middle',
                        size: 12,
                        color: '#666'
                    },
                    arrows: {
                        to: { enabled: true, scaleFactor: 1 }
                    }
                },
                physics: {
                    solver: 'barnesHut',
                    barnesHut: {
                        gravitationalConstant: -3000,
                        centralGravity: 0.3,
                        springLength: 95,
                        springConstant: 0.04,
                        damping: 0.09,
                        avoidOverlap: 0.1
                    },
                    stabilization: {
                        iterations: 1000
                    }
                },
                interaction: {
                    hover: true,
                    tooltipDelay: 300
                },
                groups: {
                    // Define colors for different node groups (labels)
                    Function: { color: { background: '#FFC107', border: '#FF9800' } },
                    Class: { color: { background: '#4CAF50', border: '#388E3C' } },
                    ApiFunction: { color: { background: '#2196F3', border: '#1976D2' } },
                    ApiType: { color: { background: '#9C27B0', border: '#7B1FA2' } },
                    Module: { color: { background: '#E91E63', border: '#C2185B' } },
                    Variable: { color: { background: '#795548', border: '#5D4037' } },
                    // Add other groups as needed
                }
            };

            const network = new vis.Network(container, data, options);

            network.once("stabilizationIterationsDone", function () {
                network.setOptions( { physics: false } );
            });

        } catch (error) {
            console.error('Error loading or drawing graph:', error);
            loadingMessage.innerText = 'Failed to load graph data. Please run the export script and ensure graph_data.json exists.';
        }
    }

    // Draw the graph when the page loads
    drawGraph();
</script>

</body>
</html>
